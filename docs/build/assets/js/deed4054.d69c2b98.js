"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[530],{5422(n,e,s){s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"ci-integration","title":"CI/CD Integration","description":"Add env-doctor to your CI pipeline to catch environment issues before they reach production.","source":"@site/docs/ci-integration.md","sourceDirName":".","slug":"/ci-integration","permalink":"/env-doctor/docs/ci-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/khushwantparihar/env-doctor/tree/main/docs/docs/ci-integration.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"docsSidebar","previous":{"title":"API Reference","permalink":"/env-doctor/docs/api-reference"},"next":{"title":"Basic Usage","permalink":"/env-doctor/docs/examples/basic-usage"}}');var r=s(4848),t=s(8453);const c={sidebar_position:12},o="CI/CD Integration",a={},l=[{value:"GitHub Actions",id:"github-actions",level:2},{value:"Basic Check",id:"basic-check",level:3},{value:"With SARIF Upload",id:"with-sarif-upload",level:3},{value:"JSON Report Artifact",id:"json-report-artifact",level:3},{value:"GitLab CI",id:"gitlab-ci",level:2},{value:"With Artifacts",id:"with-artifacts",level:3},{value:"CircleCI",id:"circleci",level:2},{value:"Azure DevOps",id:"azure-devops",level:2},{value:"Jenkins",id:"jenkins",level:2},{value:"Pre-commit Hook",id:"pre-commit-hook",level:2},{value:"Using Husky",id:"using-husky",level:3},{value:"Using lint-staged",id:"using-lint-staged",level:3},{value:"Handling Secrets in CI",id:"handling-secrets-in-ci",level:2},{value:"Don&#39;t Check Production Secrets",id:"dont-check-production-secrets",level:3},{value:"Git History Scanning in CI",id:"git-history-scanning-in-ci",level:3},{value:"Exit Codes",id:"exit-codes",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"cicd-integration",children:"CI/CD Integration"})}),"\n",(0,r.jsx)(e.p,{children:"Add env-doctor to your CI pipeline to catch environment issues before they reach production."}),"\n",(0,r.jsx)(e.h2,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,r.jsx)(e.h3,{id:"basic-check",children:"Basic Check"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"# .github/workflows/env-check.yml\nname: Environment Check\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  env-doctor:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          \n      - name: Install dependencies\n        run: npm ci\n        \n      - name: Check environment variables\n        run: npx env-doctor --ci\n"})}),"\n",(0,r.jsx)(e.h3,{id:"with-sarif-upload",children:"With SARIF Upload"}),"\n",(0,r.jsx)(e.p,{children:"Upload results to GitHub Code Scanning for inline annotations:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"name: Environment Check\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  env-doctor:\n    runs-on: ubuntu-latest\n    permissions:\n      security-events: write\n      \n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          \n      - name: Run env-doctor\n        run: npx env-doctor --ci --format sarif > results.sarif\n        continue-on-error: true\n        \n      - name: Upload SARIF\n        uses: github/codeql-action/upload-sarif@v3\n        with:\n          sarif_file: results.sarif\n"})}),"\n",(0,r.jsx)(e.h3,{id:"json-report-artifact",children:"JSON Report Artifact"}),"\n",(0,r.jsx)(e.p,{children:"Save reports as build artifacts:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"- name: Run env-doctor\n  run: npx env-doctor --format json > env-report.json\n  \n- name: Upload report\n  uses: actions/upload-artifact@v4\n  with:\n    name: env-doctor-report\n    path: env-report.json\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"gitlab-ci",children:"GitLab CI"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# .gitlab-ci.yml\nenv-check:\n  image: node:20\n  stage: test\n  script:\n    - npm ci\n    - npx env-doctor --ci\n  rules:\n    - if: $CI_PIPELINE_SOURCE == "merge_request_event"\n    - if: $CI_COMMIT_BRANCH == "main"\n'})}),"\n",(0,r.jsx)(e.h3,{id:"with-artifacts",children:"With Artifacts"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"env-check:\n  image: node:20\n  stage: test\n  script:\n    - npm ci\n    - npx env-doctor --format json > env-report.json\n  artifacts:\n    reports:\n      dotenv: env-report.json\n    paths:\n      - env-report.json\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"circleci",children:"CircleCI"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"# .circleci/config.yml\nversion: 2.1\n\njobs:\n  env-check:\n    docker:\n      - image: cimg/node:20.0\n    steps:\n      - checkout\n      - run:\n          name: Install dependencies\n          command: npm ci\n      - run:\n          name: Check environment variables\n          command: npx env-doctor --ci\n\nworkflows:\n  main:\n    jobs:\n      - env-check\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"azure-devops",children:"Azure DevOps"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"# azure-pipelines.yml\ntrigger:\n  - main\n\npool:\n  vmImage: 'ubuntu-latest'\n\nsteps:\n  - task: NodeTool@0\n    inputs:\n      versionSpec: '20.x'\n      \n  - script: npm ci\n    displayName: 'Install dependencies'\n    \n  - script: npx env-doctor --ci\n    displayName: 'Check environment variables'\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"jenkins",children:"Jenkins"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-groovy",children:"// Jenkinsfile\npipeline {\n    agent any\n    \n    stages {\n        stage('Setup') {\n            steps {\n                sh 'npm ci'\n            }\n        }\n        \n        stage('Environment Check') {\n            steps {\n                sh 'npx env-doctor --ci'\n            }\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"pre-commit-hook",children:"Pre-commit Hook"}),"\n",(0,r.jsx)(e.p,{children:"Run env-doctor before each commit:"}),"\n",(0,r.jsx)(e.h3,{id:"using-husky",children:"Using Husky"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'npm install -D husky\nnpx husky init\necho "npx env-doctor --ci" > .husky/pre-commit\n'})}),"\n",(0,r.jsx)(e.h3,{id:"using-lint-staged",children:"Using lint-staged"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "lint-staged": {\n    "*.{ts,js,tsx,jsx}": [\n      "npx env-doctor --ci"\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"handling-secrets-in-ci",children:"Handling Secrets in CI"}),"\n",(0,r.jsx)(e.h3,{id:"dont-check-production-secrets",children:"Don't Check Production Secrets"}),"\n",(0,r.jsxs)(e.p,{children:["env-doctor scans ",(0,r.jsx)(e.code,{children:".env"})," files, which should NOT contain real secrets in version control."]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Recommended approach:"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Commit ",(0,r.jsx)(e.code,{children:".env.example"})," with placeholders"]}),"\n",(0,r.jsxs)(e.li,{children:["Create ",(0,r.jsx)(e.code,{children:".env"})," in CI from environment variables"]}),"\n",(0,r.jsx)(e.li,{children:"Run env-doctor to validate configuration"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'steps:\n  - name: Create .env from secrets\n    run: |\n      echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> .env\n      echo "API_KEY=${{ secrets.API_KEY }}" >> .env\n      \n  - name: Validate environment\n    run: npx env-doctor --ci\n'})}),"\n",(0,r.jsx)(e.h3,{id:"git-history-scanning-in-ci",children:"Git History Scanning in CI"}),"\n",(0,r.jsx)(e.p,{children:"Check for leaked secrets in git history:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"- name: Scan git history\n  run: npx env-doctor scan-history --depth 50\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"exit-codes",children:"Exit Codes"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Code"}),(0,r.jsx)(e.th,{children:"Meaning"}),(0,r.jsx)(e.th,{children:"CI Behavior"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"0"})}),(0,r.jsx)(e.td,{children:"No errors"}),(0,r.jsx)(e.td,{children:"Build passes"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"1"})}),(0,r.jsx)(e.td,{children:"Errors found"}),(0,r.jsx)(e.td,{children:"Build fails"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:["Use ",(0,r.jsx)(e.code,{children:"--strict"})," to treat warnings as errors:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"- run: npx env-doctor --ci --strict\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Run on every PR"})," - Catch issues before merge"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Use SARIF for GitHub"})," - Get inline annotations"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Store reports as artifacts"})," - Track trends over time"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Use strict mode"})," - Enforce clean configuration"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Scan git history"})," - Detect historical leaks"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Don't commit real secrets"})," - Use CI environment variables"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453(n,e,s){s.d(e,{R:()=>c,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function c(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);